// seeds/transactionSeeds.js
const mongoose = require('mongoose');
const Card = require('../models/Card');
const Transaction = require('../models/Transaction');
require('dotenv').config();

const categories = [
  'Groceries',
  'Dining',
  'Travel',
  'Gas',
  'Entertainment',
  'Shopping',
  'Utilities',
  'Healthcare',
  'Transportation'
];

const merchants = [
  'Whole Foods',
  'Kroger',
  'Starbucks',
  'Chipotle',
  'Delta Airlines',
  'Marriott Hotel',
  'Shell Gas',
  'BP',
  'Netflix',
  'Amazon',
  'Target',
  'Walmart',
  'CVS Pharmacy',
  'Uber',
  'Lyft'
];

// Generate random date within last 90 days
const randomDate = () => {
  const end = new Date();
  const start = new Date();
  start.setDate(start.getDate() - 90);
  return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
};

// Generate random amount between min and max
const randomAmount = (min = 10, max = 500) => {
  return Math.round((Math.random() * (max - min) + min) * 100) / 100;
};

const seedTransactions = async () => {
  try {
    // Connect to MongoDB
    await mongoose.connect(process.env.MONGO_URI);
    console.log('MongoDB connected for seeding...');

    // Get all cards
    const cards = await Card.find();

    if (cards.length === 0) {
      console.log('No cards found. Please create cards first.');
      process.exit(1);
    }

    // Delete existing transactions
    await Transaction.deleteMany({});
    console.log('Cleared existing transactions');

    // Generate 10-20 transactions per card
    for (const card of cards) {
      const numTransactions = Math.floor(Math.random() * 11) + 10; // 10-20 transactions

      for (let i = 0; i < numTransactions; i++) {
        const category = categories[Math.floor(Math.random() * categories.length)];
        const merchant = merchants[Math.floor(Math.random() * merchants.length)];
        const amount = randomAmount();
        const date = randomDate();

        await Transaction.create({
          user: card.user,
          card: card._id,
          merchant,
          amount,
          category,
          date
        });
      }

      console.log(`Created ${numTransactions} transactions for card: ${card.name}`);
    }

    console.log('Transaction seeding complete!');
    process.exit(0);
  } catch (error) {
    console.error('Error seeding transactions:', error);
    process.exit(1);
  }
};

seedTransactions();
